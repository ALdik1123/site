<!DOCTYPE html>
<html lang="ru" data-lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RealtyKZ — Элитная недвижимость Казахстана 2025</title>
  <meta name="description" content="Продажа и аренда премиальной недвижимости в Алматы, Астане и по всему Казахстану" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <style>
:root{--p:#6366f1;--a:#a78bfa;--r:#10b981;--d:#0f172a;--l:#f8fafc;--g:#64748b;--glass:rgba(255,255,255,.15);--s:#0ea5e9;}
* {margin:0;padding:0;box-sizing:border-box;transition:all .3s ease;}
body{font-family:'Inter',sans-serif;background:var(--l);color:#1e293b;overflow-x:hidden;line-height:1.6;}
.container{max-width:1380px;margin:0 auto;padding:0 20px;}
h1,h2,h3{font-family:'Playfair Display',serif;}

header{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(255,255,255,.95);backdrop-filter:blur(16px);padding:18px 0;border-bottom:1px solid rgba(0,0,0,.05);}
header.scrolled{padding:12px 0;box-shadow:0 10px 40px rgba(0,0,0,.1);}
.header-flex{display:flex;align-items:center;justify-content:space-between;gap:20px;}
.logo{font-size:38px;font-weight:900;background:linear-gradient(135deg,var(--p),var(--a));-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:logoGlow 2s infinite alternate;}
@keyframes logoGlow{0%{text-shadow:0 0 10px rgba(99,102,241,.3);}100%{text-shadow:0 0 20px rgba(167,139,250,.5);}}
.accent{color:var(--a);}
nav ul{display:flex;gap:36px;list-style:none;}
nav a,nav button{color:#475569;font-weight:600;cursor:pointer;padding:8px 0;font-size:17px;position:relative;}
nav a::after{content:'';position:absolute;bottom:0;left:0;width:0;height:3px;background:var(--p);transition:.4s;border-radius:3px;}
nav a:hover::after{width:100%;}
.lang button{padding:10px 20px;border-radius:50px;font-weight:700;cursor:pointer;background:transparent;border:2px solid transparent;animation:pulse 1.5s infinite;}
.lang button.active{background:var(--p);color:white;animation:none;}
@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);}}

.hero{height:100vh;min-height:720px;position:relative;display:flex;align-items:center;color:white;overflow:hidden;}
.animated-gradient{background:linear-gradient(270deg,#6366f1,#a78bfa,#10b981,#6366f1);background-size:400%;animation:gradient 20s ease infinite;}
@keyframes gradient{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
.slides{position:absolute;inset:0;}
.slide{position:absolute;inset:0;opacity:0;transition:opacity 2s;background:center/cover no-repeat;animation:slideZoom 10s infinite alternate;}
.slide::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(15,23,42,.88),rgba(99,102,241,.7));}
.slide.active{opacity:1;}
@keyframes slideZoom{0%{transform:scale(1);}100%{transform:scale(1.05);}}
.hero-content{text-align:center;z-index:2;animation:heroFade 1.5s ease-out;}
@keyframes heroFade{from{opacity:0;transform:translateY(50px);}to{opacity:1;transform:translateY(0);}}
.typewriter{overflow:hidden;border-right:3px solid white;white-space:nowrap;animation:typing 4s steps(40) forwards,blink 1s infinite;}
@keyframes typing{from{width:0}to{width:100%}}
@keyframes blink{50%{border-color:transparent}}
.btn{padding:18px 44px;border:none;border-radius:50px;font-weight:700;font-size:19px;cursor:pointer;display:inline-flex;align-items:center;gap:12px;position:relative;overflow:hidden;}
.btn:hover{transform:translateY(-8px) scale(1.05);box-shadow:0 20px 40px rgba(99,102,241,.5);animation:btnHover 0.5s;}
.btn.primary{background:var(--p);color:white;}
.btn.success{background:var(--r);color:white;}
.btn.secondary{background:var(--s);color:white;}
.btn.danger{background:#ef4444;color:white;}
.btn::before{content:'';position:absolute;inset:0;background:rgba(255,255,255,.3);transform:translateX(-100%);transition:transform .6s;}
.btn:hover::before{transform:translateX(100%);}
@keyframes btnHover{0%{box-shadow:0 0 0 rgba(99,102,241,.3);}100%{box-shadow:0 20px 40px rgba(99,102,241,.5);}}
.section{padding:140px 0;animation:sectionLoad 1s ease;}
@keyframes sectionLoad{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}
.section-title{font-size:52px;text-align:center;margin-bottom:80px;position:relative;animation:titlePulse 2s infinite;}
.section-title::after{content:'';position:absolute;bottom:-20px;left:50%;transform:translateX(-50%);width:120px;height:5px;background:var(--p);border-radius:5px;animation:lineGrow 1.5s ease-in-out infinite;}
@keyframes titlePulse{0%{text-shadow:0 0 5px rgba(99,102,241,.2);}50%{text-shadow:0 0 15px rgba(99,102,241,.4);}100%{text-shadow:0 0 5px rgba(99,102,241,.2);}}
@keyframes lineGrow{0%{width:0;}50%{width:140px;}100%{width:120px;}}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:40px;}
.card{background:white;border-radius:28px;overflow:hidden;box-shadow:0 15px 45px rgba(0,0,0,.08);transition:.6s;cursor:pointer;animation:cardFloat 3s infinite ease-in-out;}
.card:hover{transform:translateY(-20px) rotateX(5deg) rotateY(5deg);box-shadow:0 35px 80px rgba(0,0,0,.18);animation:none;}
@keyframes cardFloat{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);}}
.card img{width:100%;height:280px;object-fit:cover;transition:.8s;filter:brightness(0.9);}
.card:hover img{transform:scale(1.12);filter:brightness(1);}
.card-body{padding:32px;animation:bodyFade 0.8s;}
@keyframes bodyFade{from{opacity:0;}to{opacity:1;}}
.price{font-size:32px;font-weight:900;color:var(--p);}
.price.r{color:var(--r);}
.benefits-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:30px;}
.benefit-card{background:white;padding:40px;border-radius:24px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.06);animation:benefitBounce 2s infinite;}
@keyframes benefitBounce{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}
.whatsapp-float{position:fixed;bottom:30px;right:30px;background:#25d366;color:white;width:66px;height:66px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:34px;box-shadow:0 10px 30px rgba(37,211,102,.4);z-index:999;animation:float 3s infinite;cursor:pointer;}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
.particles{position:absolute;inset:0;overflow:hidden;pointer-events:none;}
.particle{position:absolute;background:rgba(99,102,241,.3);border-radius:50%;animation:floatParticle 15s infinite linear, particleColor 5s infinite alternate;}
@keyframes particleColor{0%{background:rgba(99,102,241,.3);}50%{background:rgba(167,139,250,.3);}100%{background:rgba(16,185,129,.3);}}
@keyframes floatParticle{0%{transform:translateY(100vh) translateX(-50%);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(-100px) translateX(100vw);opacity:0}}
#cursor-trail{position:fixed;pointer-events:none;z-index:9999;}
.trail-dot{position:absolute;width:8px;height:8px;background:var(--p);border-radius:50%;animation:trailFade 1s forwards, trailColor 0.5s infinite;}
@keyframes trailColor{0%{background:var(--p);}50%{background:var(--a);}100%{background:var(--r);}}
@keyframes trailFade{to{transform:scale(0);opacity:0}}

.bg-light{background:var(--l);}
.dark{background:var(--d);color:white;}
.glass-card{background:var(--glass);backdrop-filter:blur(12px);border-radius:20px;padding:30px;text-align:center;box-shadow:0 8px 32px rgba(0,0,0,.1);border:1px solid rgba(255,255,255,.1);transition:all .4s;animation:glassShine 3s infinite;}
.glass-card:hover{transform:scale(1.05);box-shadow:0 12px 48px rgba(0,0,0,.2);}
@keyframes glassShine{0%{border-color:rgba(255,255,255,.1);}50%{border-color:rgba(255,255,255,.3);}100%{border-color:rgba(255,255,255,.1);}}
.filters input{width:100%;max-width:400px;padding:12px 20px;border-radius:50px;border:2px solid var(--g);margin-bottom:20px;animation:inputFocus 2s infinite;}
@keyframes inputFocus{0%{box-shadow:0 0 5px rgba(99,102,241,.1);}50%{box-shadow:0 0 10px rgba(99,102,241,.2);}100%{box-shadow:0 0 5px rgba(99,102,241,.1);}}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:10000;animation:fadeIn .3s;}
.modal.show{display:flex;}
.modal-content{background:white;padding:40px;border-radius:24px;width:90%;max-width:500px;text-align:center;animation:zoomIn .4s, modalGlow 2s infinite;}
.large{max-width:800px;}
.close{float:right;cursor:pointer;font-size:28px;color:var(--g);transition:color .3s;}
.close:hover{color:var(--p);}
@keyframes modalGlow{0%{box-shadow:0 0 10px rgba(99,102,241,.2);}50%{box-shadow:0 0 20px rgba(99,102,241,.4);}100%{box-shadow:0 0 10px rgba(99,102,241,.2);}}
#adminTabs{display:flex;justify-content:center;gap:10px;margin-bottom:20px;}
#adminTabs button{padding:12px 24px;border:none;background:var(--g);color:white;border-radius:50px;cursor:pointer;transition:all .3s;}
#adminTabs button.active{background:var(--p);box-shadow:0 4px 12px rgba(99,102,241,.3);}
.request-card{background:var(--l);padding:20px;margin:10px 0;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1);transition:all .3s;animation:requestAppear 0.5s;}
.request-card:hover{transform:translateY(-5px);box-shadow:0 8px 24px rgba(0,0,0,.15);}
@keyframes requestAppear{from{opacity:0;transform:scale(0.95);}to{opacity:1;transform:scale(1);}}
.edit-card{display:flex;justify-content:space-between;align-items:center;background:var(--l);padding:16px;margin:10px 0;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1);animation:editSlide 0.5s;}
@keyframes editSlide{from{transform:translateX(-20px);opacity:0;}to{transform:translateX(0);opacity:1;}}
.edit-card button{margin-left:10px;padding:8px 16px;border-radius:50px;font-size:14px;}

@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes zoomIn{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}
#propertyDetails .gallery{display:flex;overflow-x:auto;gap:10px;margin-bottom:20px;scroll-snap-type:x mandatory;animation:galleryScroll 10s infinite linear;}
#propertyDetails .gallery img{width:200px;height:150px;object-fit:cover;border-radius:12px;cursor:pointer;transition:transform .3s;scroll-snap-align:start;}
#propertyDetails .gallery img:hover{transform:scale(1.05);}
@keyframes galleryScroll{0%{scroll-left:0;}100%{scroll-left:100%;}}
#propertyDetails .main-img{width:100%;border-radius:12px;margin-bottom:20px;animation:mainImgFade 1s;}
@keyframes mainImgFade{from{opacity:0;}to{opacity:1;}}
#propertyDetails .features{list-style:none;padding:0;}
#propertyDetails .features li{margin:10px 0;background:var(--glass);padding:12px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.05);animation:featurePop 0.5s;}
@keyframes featurePop{from{transform:scale(0.9);opacity:0;}to{transform:scale(1);opacity:1;}}

.form-group{margin-bottom:20px;text-align:left;animation:formGroupLoad 0.8s;}
@keyframes formGroupLoad{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.form-group label{display:block;margin-bottom:8px;font-weight:600;color:#475569;}
.form-group input, .form-group textarea, .form-group select{width:100%;padding:12px;border:2px solid var(--g);border-radius:12px;background:white;outline:none;transition:all .3s;}
.form-group input:focus, .form-group textarea:focus, .form-group select:focus{border-color:var(--p);box-shadow:0 0 0 4px rgba(99,102,241,.1);animation:inputFocusAnim 0.5s;}
@keyframes inputFocusAnim{0%{box-shadow:0 0 0 rgba(99,102,241,.1);}100%{box-shadow:0 0 0 4px rgba(99,102,241,.1);}}
.contact-form{max-width:600px;margin:0 auto;}

#propertyDetail { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999; overflow-y: auto; }
#propertyDetail .container { padding-top: 80px; }
#propertyDetail h2 { font-size: 48px; margin-bottom: 20px; }
#propertyDetail p { font-size: 18px; line-height: 1.8; margin-bottom: 15px; }
#propertyDetail .price { font-size: 36px; color: var(--p); margin-top: 30px; }
.gallery-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 15px;
  margin-top: 20px;
}
.gallery-grid img {
  width: 100%;
  height: 180px;
  object-fit: cover;
  border-radius: 16px;
  cursor: pointer;
  transition: .4s;
  box-shadow: 0 8px 25px rgba(0,0,0,.15);
}
.gallery-grid img:hover {
  transform: scale(1.05);
  box-shadow: 0 15px 40px rgba(99,102,241,.4);
}

.feature-item {
  background: white;
  padding: 18px;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0,0,0,.08);
  font-size: 17px;
}

/* Мобильная адаптация */
@media (max-width: 768px) {
  :root { --font-size: 16px; }
  * { box-sizing: border-box; }
  body { font-size: var(--font-size); overflow-x: hidden; }
  .container { padding: 0 15px; max-width: 100%; }
  header { padding: 12px 0; }
  .header-flex { flex-direction: column; gap: 15px; }
  nav ul { display: none; flex-direction: column; gap: 12px; align-items: center; position: absolute; top: 100%; left: 0; right: 0; background: rgba(255,255,255,0.98); padding: 20px 15px; border-radius: 0 0 16px 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
  nav ul.active { display: flex; }
  nav a, nav button { font-size: 16px; padding: 8px 0; text-align: center; }
  .menu-toggle { display: flex; order: 2; margin-left: auto; flex-direction: column; justify-content: space-around; width: 28px; height: 22px; cursor: pointer; z-index: 1001; }
  .menu-toggle span { height: 3px; width: 100%; background: #333; border-radius: 10px; transition: all 0.3s; }
  .menu-toggle.active span:nth-child(1) { transform: rotate(45deg) translate(4px, 4px); }
  .menu-toggle.active span:nth-child(2) { opacity: 0; }
  .menu-toggle.active span:nth-child(3) { transform: rotate(-45deg) translate(6px, -5px); }
  .logo { font-size: 32px; }
  .lang button { padding: 8px 16px; font-size: 14px; }
  .hero { min-height: 600px; padding-top: 80px; }
  .hero-content { text-align: center; padding: 0 20px; }
  .hero h1 { font-size: 32px; }
  .hero p { font-size: 18px; }
  .hero-buttons { flex-direction: column; gap: 12px; align-items: center; }
  .btn { padding: 12px 24px; font-size: 16px; }
  .section { padding: 80px 0; }
  .section-title { font-size: 36px; }
  .section-title::after { width: 80px; }
  .grid { grid-template-columns: 1fr; gap: 20px; }
  .card { max-width: 100%; }
  .card img { height: 200px; }
  .benefits-grid { grid-template-columns: 1fr; }
  .glass-card { padding: 20px; }
  .form-group input, .form-group textarea, .form-group select { padding: 10px; }
  .modal-content { width: 95%; padding: 20px; }
  #propertyDetail { padding: 40px 0; }
  #propertyDetail .container { padding-top: 100px; }
  .gallery-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
  .gallery-grid img { height: 140px; }
  .whatsapp-float { width: 56px; height: 56px; font-size: 28px; }
  #adminTabs { flex-wrap: wrap; }
  #adminTabs button { padding: 8px 12px; font-size: 14px; }
  .edit-card { flex-direction: column; gap: 10px; }
  .edit-card button { width: 100%; margin: 5px 0; }
  .filters input { max-width: 100%; }
  .card:hover, .btn:hover, .glass-card:hover { transform: none; box-shadow: none; }
}

@media (max-width: 480px) {
  .hero h1 { font-size: 28px; }
  .hero p { font-size: 16px; }
  .section-title { font-size: 30px; }
  .btn { padding: 10px 20px; font-size: 14px; }
  .card img { height: 180px; }
  .gallery-grid { grid-template-columns: 1fr; }
}

@media (prefers-reduced-motion: reduce) {
  * { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
}
  </style>
</head>
<body>

<header>
  <div class="container header-flex">
    <div class="logo">Realty<span class="accent">KZ</span></div>
    <div class="menu-toggle">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <nav>
      <ul>
        <li><a onclick="instantScroll('#home')">Главная</a></li>
        <li><a onclick="instantScroll('#catalog')">Продажа</a></li>
        <li><a onclick="instantScroll('#rental')">Аренда</a></li>
        <li><a onclick="instantScroll('#about')">О нас</a></li>
        <li><a onclick="instantScroll('#contact')">Контакты</a></li>
        <li id="adminLink" style="display:none"><button class="admin-btn" onclick="openAdminPanel()">Admin Panel</button></li>
        <li id="profileLink" style="display:none"><button onclick="openProfile()">Профиль</button></li>
        <li id="loginLink"><button onclick="openLoginModal()">Войти</button></li>
        <li id="logoutLink" style="display:none"><button onclick="logout()">Выйти</button></li>
      </ul>
    </nav>
    <div class="lang">
      <button class="active" onclick="setLang('ru')">RU</button>
      <button onclick="setLang('kk')">KZ</button>
    </div>
  </div>
</header>

<section class="hero animated-gradient" id="home">
  <div class="particles"></div>
  <div class="slides">
    <div class="slide active" style="background-image:url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=1920')"></div>
    <div class="slide" style="background-image:url('https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=1920')"></div>
    <div class="slide" style="background-image:url('https://images.unsplash.com/photo-1600563438938-a9a27216b4dc?w=1920')"></div>
    <div class="slide" style="background-image:url('https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=1920')"></div>
  </div>
  <div class="container hero-content" data-aos="fade-up">
    <h1 class="typewriter ru">Ваш дом мечты уже ждёт вас</h1>
    <h1 class="typewriter kk" style="display:none">Армандаған үйіңіз сізді күтіп тұр</h1>
    <p class="ru">Элитная недвижимость в лучших локациях Казахстана</p>
    <p class="kk" style="display:none">Қазақстанның үздік жерлеріндегі элиталық жылжымайтын мүлік</p>
    <div class="hero-buttons">
      <button class="btn primary" onclick="instantScroll('#catalog')">Купить</button>
      <button class="btn success" onclick="instantScroll('#rental')">Арендовать</button>
    </div>
  </div>
</section>

<section id="catalog" class="section">
  <div class="container">
    <h2 class="section-title" data-aos="fade-down"><span class="ru">Продажа недвижимости</span><span class="kk">Жылжымайтын мүлік сату</span></h2>
    <div class="filters" data-aos="fade-up">
      <input type="text" id="searchSale" placeholder="Поиск..." oninput="render('sale')">
    </div>
    <div class="grid" id="saleCards"></div>
  </div>
</section>

<section id="rental" class="section bg-light">
  <div class="container">
    <h2 class="section-title" data-aos="fade-down"><span class="ru">Аренда недвижимости</span><span class="kk">Жалға беру</span></h2>
    <div class="filters" data-aos="fade-up">
      <input type="text" id="searchRental" placeholder="Поиск..." oninput="render('rental')">
    </div>
    <div class="grid" id="rentalCards"></div>
  </div>
</section>

<section id="about" class="section dark">
  <div class="container">
    <h2 class="section-title" data-aos="fade-down"><span class="ru">О нас</span><span class="kk">Біз туралы</span></h2>
    <p class="about-text ru" data-aos="zoom-in">RealtyKZ — лидер в элитной недвижимости Казахстана с 2010 года.</p>
    <p class="about-text kk" style="display:none" data-aos="zoom-in">RealtyKZ — 2010 жылдан бері Қазақстандағы элиталық жылжымайтын мүліктің көшбасшысы.</p>
    <div class="benefits-grid">
      <div class="glass-card" data-aos="flip-left" data-tilt><i class="fas fa-trophy"></i><br><span class="ru">15 лет опыта</span><span class="kk">15 жыл тәжірибе</span></div>
      <div class="glass-card" data-aos="flip-left" data-aos-delay="200" data-tilt><i class="fas fa-shield-alt"></i><br><span class="ru">100% чистота сделок</span><span class="kk">100% таза мәмілелер</span></div>
      <div class="glass-card" data-aos="flip-left" data-aos-delay="400" data-tilt><i class="fas fa-headset"></i><br><span class="ru">Поддержка 24/7</span><span class="kk">24/7 қолдау</span></div>
    </div>
  </div>
</section>

<section id="contact" class="section">
  <div class="container">
    <h2 class="section-title" data-aos="fade-down"><span class="ru">Контакты</span><span class="kk">Байланыс</span></h2>
    <form id="contactForm" data-aos="fade-up" class="contact-form" onsubmit="submitRequest(event)">
      <div class="form-group">
        <label for="name"><span class="ru">Имя</span><span class="kk">Аты</span></label>
        <input type="text" id="name" placeholder="Ваше имя" required>
      </div>
      <div class="form-group">
        <label for="phone"><span class="ru">Телефон</span><span class="kk">Телефон</span></label>
        <input type="tel" id="phone" placeholder="+7 (___) ___-__-__" required pattern="[+]?[0-9\s\-\(\)]{10,20}">
      </div>
      <div class="form-group">
        <label for="email"><span class="ru">Email</span><span class="kk">Email</span></label>
        <input type="email" id="email" placeholder="your@email.com" required>
      </div>
      <div class="form-group">
        <label for="message"><span class="ru">Сообщение</span><span class="kk">Хабарлама</span></label>
        <textarea id="message" placeholder="Ваше сообщение..." rows="5" required></textarea>
      </div>
      <button class="btn primary" type="submit">Отправить</button>
    </form>
  </div>
</section>

<section id="propertyDetail" class="section" style="display:none; padding:60px 0; background:#f8fafc;">
  <div class="container">
    <button class="btn secondary" onclick="backToList()" style="margin-bottom:20px;"><i class="fas fa-arrow-left"></i> Назад</button>
    <div id="propertyDetails"></div>
    <div id="propertyActions" style="margin-top:30px;text-align:center;display:flex;gap:15px;justify-content:center;">
      <button class="btn success" onclick="contactWhatsapp()"><i class="fab fa-whatsapp"></i> Написать в WhatsApp</button>
      <button class="btn primary" onclick="openRequestModal()"><i class="fas fa-envelope"></i> Оставить заявку</button>
      <button class="btn secondary" onclick="shareProperty()"><i class="fas fa-share-alt"></i> Поделиться</button>
      <button class="btn danger" onclick="saveFavorite()"><i class="fas fa-heart"></i> В избранное</button>
    </div>
  </div>
</section>

<div class="whatsapp-float" onclick="window.open('https://wa.me/77714829862','_blank')">
  <i class="fab fa-whatsapp"></i>
</div>

<div id="cursor-trail"></div>

<div id="loginModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('loginModal')">&times;</span>
    <h2><span class="ru">Вход</span><span class="kk">Кіру</span></h2>
    <div class="form-group">
      <label for="loginUsername"><span class="ru">Логин</span><span class="kk">Логин</span></label>
      <input id="loginUsername" placeholder="Ваш логин">
    </div>
    <div class="form-group">
      <label for="loginPassword"><span class="ru">Пароль</span><span class="kk">Құпия сөз</span></label>
      <input id="loginPassword" type="password" placeholder="Пароль">
    </div>
    <button class="btn primary" onclick="login()">Войти</button>
    <p><span class="ru">Нет аккаунта?</span><span class="kk">Аккаунт жоқ па?</span> <a onclick="openRegisterModal()">Зарегистрироваться</a></p>
  </div>
</div>

<div id="registerModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('registerModal')">&times;</span>
    <h2><span class="ru">Регистрация</span><span class="kk">Тіркелу</span></h2>
    <div class="form-group">
      <label for="regUsername"><span class="ru">Логин</span><span class="kk">Логин</span></label>
      <input id="regUsername" placeholder="Ваш логин">
    </div>
    <div class="form-group">
      <label for="regPassword"><span class="ru">Пароль</span><span class="kk">Құпия сөз</span></label>
      <input id="regPassword" type="password" placeholder="Пароль">
    </div>
    <div class="form-group">
      <label for="regRole"><span class="ru">Роль</span><span class="kk">Рөл</span></label>
      <select id="regRole"><option value="user">Пользователь</option><option value="admin">Админ</option></select>
    </div>
    <button class="btn primary" onclick="register()">Зарегистрироваться</button>
  </div>
</div>

<div id="adminPanel" class="modal">
  <div class="modal-content large">
    <span class="close" onclick="closeModal('adminPanel')">&times;</span>
    <h2><span class="ru">Админ Панель</span><span class="kk">Әкімші Панелі</span></h2>
    <div id="adminTabs">
      <button class="active" onclick="showAdminTab('addProp')">Добавить Объект</button>
      <button onclick="showAdminTab('editProps')">Редактировать Объекты</button>
      <button onclick="showAdminTab('requests')">Заявки</button>
    </div>
    <div id="addPropTab">
      <div class="form-group">
        <label for="adminTitleRu">Название RU</label>
        <input id="adminTitleRu" placeholder="Название на русском">
      </div>
      <div class="form-group">
        <label for="adminTitleKk">Название KK</label>
        <input id="adminTitleKk" placeholder="Атауы қазақша">
      </div>
      <div class="form-group">
        <label for="adminPrice">Цена</label>
        <input id="adminPrice" type="number" placeholder="Цена в ₸">
      </div>
      <div class="form-group">
        <label for="adminDesc">Описание</label>
        <textarea id="adminDesc" placeholder="Полное описание" rows="4"></textarea>
      </div>
      <div class="form-group">
        <label for="adminLocation">Локация</label>
        <input id="adminLocation" placeholder="Город, район">
      </div>
      <div class="form-group">
        <label for="adminYear">Год постройки</label>
        <input id="adminYear" type="number" placeholder="Год">
      </div>
      <div class="form-group">
        <label for="adminFeatures">Особенности (площадь, комнаты, этаж/земля через ,)</label>
        <input id="adminFeatures" placeholder="250 м², 5 комнат, 20 этаж">
      </div>
      <div class="form-group">
        <label for="adminImg">Изображения (через ,)</label>
        <input id="adminImg" placeholder="URL1, URL2">
      </div>
      <div class="form-group">
        <label for="adminTags">Теги (через ,)</label>
        <input id="adminTags" placeholder="Пентхаус, Новострой">
      </div>
      <div class="form-group">
        <label for="adminCategory">Категория</label>
        <select id="adminCategory"><option value="sale">Продажа</option><option value="rental">Аренда</option></select>
      </div>
      <div class="form-group">
        <label for="adminType">Тип</label>
        <select id="adminType"><option value="apartment">Квартира</option><option value="house">Дом</option><option value="commercial">Коммерческая</option></select>
      </div>
      <button class="btn primary" onclick="addProperty()">Добавить</button>
    </div>
    <div id="editPropsTab" style="display:none">
      <h3>Редактировать Объекты</h3>
      <div id="editPropsList"></div>
    </div>
    <div id="requestsTab" style="display:none">
      <h3>Заявки</h3>
      <div id="requestsList"></div>
    </div>
  </div>
</div>

<div id="requestModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('requestModal')">&times;</span>
    <h2>Оставить заявку</h2>
    <form onsubmit="submitPropertyRequest(event)">
      <input type="hidden" id="requestPropId">
      <div class="form-group">
        <label for="requestName">Имя</label>
        <input id="requestName" placeholder="Ваше имя" required>
      </div>
      <div class="form-group">
        <label for="requestPhone">Телефон</label>
        <input id="requestPhone" type="tel" placeholder="+7 (___) ___-__-__" required>
      </div>
      <div class="form-group">
        <label for="requestMessage">Сообщение</label>
        <textarea id="requestMessage" placeholder="Ваш вопрос или комментарий" rows="3"></textarea>
      </div>
      <button class="btn primary" type="submit">Отправить</button>
    </form>
  </div>
</div>

<div id="editPropertyModal" class="modal">
  <div class="modal-content large">
    <span class="close" onclick="closeModal('editPropertyModal')">&times;</span>
    <h2>Редактировать Объект</h2>
    <div id="editPropertyForm"></div>
  </div>
</div>

<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
<script>
AOS.init({duration:1200,easing:'ease-in-out',once:false});

function setLang(l) {
  document.body.setAttribute('data-lang', l);
  localStorage.setItem('lang', l);
  document.querySelectorAll('.ru, .kk').forEach(el => el.style.display = 'none');
  document.querySelectorAll('.' + l).forEach(el => el.style.display = 'block');
  document.querySelectorAll('.lang button').forEach(b => b.classList.remove('active'));
  document.querySelector(`.lang button[onclick="setLang('${l}')"]`).classList.add('active');
  render('sale'); render('rental');
}
setLang(localStorage.getItem('lang') || 'ru');

function instantScroll(t) { document.querySelector(t).scrollIntoView({behavior:'instant'}); }

window.addEventListener('load', () => {
  createParticles();
  startSlideShow();
  updateAuthUI();
  document.querySelector('.menu-toggle').addEventListener('click', function() {
    this.classList.toggle('active');
    document.querySelector('nav ul').classList.toggle('active');
  });
});

function createParticles() {
  const container = document.querySelector('.particles');
  setInterval(() => {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.width = p.style.height = Math.random()*8+4+'px';
    p.style.left = Math.random()*100+'%';
    p.style.animationDuration = Math.random()*10+10+'s';
    container.appendChild(p);
    setTimeout(() => p.remove(), 20000);
  }, 300);
}

document.addEventListener('mousemove', e => {
  const trail = document.getElementById('cursor-trail');
  const dot = document.createElement('div');
  dot.className = 'trail-dot';
  dot.style.left = e.clientX + 'px';
  dot.style.top = e.clientY + 'px';
  trail.appendChild(dot);
  setTimeout(() => dot.remove(), 1000);
});

let currentSlide = 0;
function startSlideShow() {
  const slides = document.querySelectorAll('.slide');
  setInterval(() => {
    slides[currentSlide].classList.remove('active');
    currentSlide = (currentSlide + 1) % slides.length;
    slides[currentSlide].classList.add('active');
  }, 5000);
}

let properties = {
  sale: JSON.parse(localStorage.getItem('properties_sale') || '[]'),
  rental: JSON.parse(localStorage.getItem('properties_rental') || '[]')
};

const featuredProperties = [
  {
    id: 9999,
    ru: "Пентхаус в Golden Square, Алматы",
    kk: "Алтын алаңдағы пентхаус, Алматы",
    price: 450000000,
    desc: "Эксклюзивный пентхаус 420 м² с панорамным видом на горы и город. 4 спальни, терраса 150 м², смарт-дом.",
    location: "Алматы, Бостандыкский район",
    year: 2024,
    features: { area: "420 м²", rooms: "8 комнат", floor: "20 из 20", land: null },
    images: [
      "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=1200",
      "https://images.unsplash.com/photo-1600564013799919-ab600027ffc6?w=1200",
      "https://images.unsplash.com/photo-1600563438938-a9a27216b4dc?w=1200"
    ],
    tags: ["Топ", "Пентхаус", "Люкс", "Новострой"],
    type: "apartment",
    featured: true
  },
  {
    id: 9998,
    ru: "Вилла у озера, Астана",
    kk: "Көл жағасындағы вилла, Астана",
    price: 1200000000,
    desc: "Премиальная вилла 800 м² с собственным выходом к воде. Ландшафтный дизайн, бассейн, баня.",
    location: "Астана, Есильский район",
    year: 2025,
    features: { area: "800 м²", rooms: "12 комнат", floor: null, land: "15 соток" },
    images: [
      "https://images.unsplash.com/photo-1613977257363-707ba9348227?w=1200",
      "https://images.unsplash.com/photo-1600596543559-3b89a1c957c3?w=1200",
      "https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?w=1200"
    ],
    tags: ["Топ", "Вилла", "Озеро", "Элитная"],
    type: "house",
    featured: true
  }
];

if (properties.sale.length === 0) {
  properties.sale = [
    ...featuredProperties,
    {
      id: 1, ru: "3-комнатная в ЖК Almaty Towers", kk: "Almaty Towers-та 3 бөлмелі", price: 125000000, desc: "Светлая квартира с ремонтом", location: "Алматы", year: 2023,
      features: { area: "120 м²", rooms: "3", floor: "12 из 16", land: null }, images: ["https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=1200"], tags: ["Новострой", "Ремонт"], type: "apartment"
    }
  ];
  localStorage.setItem('properties_sale', JSON.stringify(properties.sale));
}

if (properties.rental.length === 0) {
  properties.rental = [
    { id: 101, ru: "Аренда офиса 200 м²", kk: "Офис 200 м² жалға", price: 3000000, desc: "Бизнес-центр класса А", location: "Астана", year: 2022, features: { area: "200 м²" }, images: ["https://images.unsplash.com/photo-1497366216548-37526070297c?w=1200"], tags: ["Офис"], type: "commercial" }
  ];
  localStorage.setItem('properties_rental', JSON.stringify(properties.rental));
}

let requests = JSON.parse(localStorage.getItem('requests') || '[]');
let users = JSON.parse(localStorage.getItem('users') || '[]');
let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
let currentPropId = null;
let currentCat = null;

function render(cat) {
  const lang = document.body.getAttribute('data-lang') === 'kk' ? 'kk' : 'ru';
  const container = document.getElementById(cat + 'Cards');
  const search = document.getElementById('search' + (cat==='sale'?'Sale':'Rental'))?.value.toLowerCase() || '';
  const filtered = properties[cat].filter(p => p[lang].toLowerCase().includes(search));

  container.innerHTML = filtered.map((p,i) => `
    <div class="card" data-aos="fade-up" data-aos-delay="${i*150}" onclick="showFullProperty('${cat}', ${p.id})">
      <img src="${p.images[0]}" loading="lazy">
      <div class="card-body">
        <h3>${p[lang]}</h3>
        <div class="price${cat==='rental'?' r':''}">${p.price.toLocaleString()} ₸${cat==='rental'?' /мес':''}</div>
        <div class="tags">${p.tags.map(t=>`<span class="tag">${t}</span>`).join('')}</div>
      </div>
    </div>
  `).join('');
  AOS.refresh();
}

render('sale'); render('rental');

function showFullProperty(cat, id) {
  const lang = document.body.getAttribute('data-lang') === 'kk' ? 'kk' : 'ru';
  const prop = properties[cat].find(p => p.id === id);
  currentPropId = id;
  currentCat = cat;
  const gallery = prop.images.length > 1 ? `<div class="gallery">${prop.images.slice(1).map(img => `<img src="${img}" alt="Галерея">`).join('')}</div>` : '';
  document.getElementById('propertyDetails').innerHTML = `
    <img class="main-img" src="${prop.images[0]}" alt="${prop[lang]}">
    ${gallery}
    <h2>${prop[lang]}</h2>
    <p>${prop.desc}</p>
    <p><strong>Локация:</strong> ${prop.location}</p>
    <p><strong>Год постройки:</strong> ${prop.year}</p>
    <p><strong>Тип:</strong> ${prop.type}</p>
    <ul class="features">
      ${Object.entries(prop.features).map(([key, val]) => `<li><strong>${key.charAt(0).toUpperCase() + key.slice(1)}:</strong> ${val}</li>`).join('')}
    </ul>
    <div class="price">${prop.price.toLocaleString()} ₸</div>
  `;
  document.querySelectorAll('section:not(#propertyDetail)').forEach(sec => sec.style.display = 'none');
  document.getElementById('propertyDetail').style.display = 'block';
  instantScroll('#propertyDetail');
  confetti();
}

function backToList() {
  document.querySelectorAll('section:not(#propertyDetail)').forEach(sec => sec.style.display = 'block');
  document.getElementById('propertyDetail').style.display = 'none';
  instantScroll('#' + currentCat);
}

function closeModal(id) {
  document.getElementById(id).classList.remove('show');
}

function contactWhatsapp() {
  window.open('https://wa.me/77714829862?text=Интересуюсь объектом ID: ' + currentPropId, '_blank');
}

function openRequestModal() {
  document.getElementById('requestPropId').value = currentPropId;
  document.getElementById('requestModal').classList.add('show');
}

function submitPropertyRequest(e) {
  e.preventDefault();
  const propId = document.getElementById('requestPropId').value;
  const name = document.getElementById('requestName').value;
  const phone = document.getElementById('requestPhone').value;
  const message = document.getElementById('requestMessage').value;
  requests.push({propId, name, phone, message, date: new Date().toLocaleString()});
  localStorage.setItem('requests', JSON.stringify(requests));
  alert('Заявка оставлена!');
  closeModal('requestModal');
  confetti();
}

function shareProperty() {
  const url = window.location.href + '#property-' + currentPropId;
  navigator.clipboard.writeText(url).then(() => alert('Ссылка скопирована!'));
}

function saveFavorite() {
  alert('Добавлено в избранное! (Функция в разработке)');
}

function openLoginModal() {
  document.getElementById('loginModal').classList.add('show');
}

function openRegisterModal() {
  closeModal('loginModal');
  document.getElementById('registerModal').classList.add('show');
}

function register() {
  const username = document.getElementById('regUsername').value.trim();
  const password = document.getElementById('regPassword').value.trim();
  const role = document.getElementById('regRole').value;
  if (!username || !password) return alert('Заполните поля');
  if (users.find(u => u.username === username)) return alert('Пользователь существует');
  users.push({username, password, role});
  localStorage.setItem('users', JSON.stringify(users));
  alert('Регистрация успешна! Войдите.');
  closeModal('registerModal');
  openLoginModal();
  confetti();
}

function login() {
  const username = document.getElementById('loginUsername').value.trim();
  const password = document.getElementById('loginPassword').value.trim();
  const user = users.find(u => u.username === username && u.password === password);
  if (!user) return alert('Неверные данные');
  currentUser = user;
  localStorage.setItem('currentUser', JSON.stringify(currentUser));
  updateAuthUI();
  closeModal('loginModal');
  alert('Добро пожаловать, ' + username + '!');
  confetti();
}

function logout() {
  currentUser = null;
  localStorage.removeItem('currentUser');
  updateAuthUI();
}

function updateAuthUI() {
  currentUser = JSON.parse(localStorage.getItem('currentUser'));
  document.getElementById('loginLink').style.display = currentUser ? 'none' : 'block';
  document.getElementById('logoutLink').style.display = currentUser ? 'block' : 'none';
  document.getElementById('adminLink').style.display = currentUser && currentUser.role === 'admin' ? 'block' : 'none';
  document.getElementById('profileLink').style.display = currentUser ? 'block' : 'none';
}

function openProfile() {
  alert('Профиль: ' + currentUser.username + ' (' + currentUser.role + ')');
}

function submitRequest(e) {
  e.preventDefault();
  const form = e.target;
  if (!form.checkValidity()) return alert('Заполните все поля правильно!');
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const email = document.getElementById('email').value;
  const message = document.getElementById('message').value;
  requests.push({name, phone, email, message, date: new Date().toLocaleString()});
  localStorage.setItem('requests', JSON.stringify(requests));
  alert('Заявка отправлена!');
  form.reset();
  confetti();
}

function openAdminPanel() {
  showAdminTab('addProp');
  renderRequests();
  renderEditProps();
  document.getElementById('adminPanel').classList.add('show');
}

function showAdminTab(tab) {
  document.getElementById('addPropTab').style.display = tab === 'addProp' ? 'block' : 'none';
  document.getElementById('editPropsTab').style.display = tab === 'editProps' ? 'block' : 'none';
  document.getElementById('requestsTab').style.display = tab === 'requests' ? 'block' : 'none';
  document.querySelectorAll('#adminTabs button').forEach(b => b.classList.remove('active'));
  document.querySelector(`#adminTabs button[onclick="showAdminTab('${tab}')"]`).classList.add('active');
}

function addProperty() {
  const cat = document.getElementById('adminCategory').value;
  const ru = document.getElementById('adminTitleRu').value.trim();
  const kk = document.getElementById('adminTitleKk').value.trim();
  const price = parseInt(document.getElementById('adminPrice').value);
  const desc = document.getElementById('adminDesc').value.trim();
  const location = document.getElementById('adminLocation').value.trim();
  const year = parseInt(document.getElementById('adminYear').value) || new Date().getFullYear();
  const featuresInput = document.getElementById('adminFeatures').value.trim();
  const imgInput = document.getElementById('adminImg').value.trim();
  const tagsInput = document.getElementById('adminTags').value.trim();
  const type = document.getElementById('adminType').value;

  if (!ru || !kk || !price || !desc || !location) return alert("Заполните обязательные поля: Название, Цена, Описание, Локация!");

  const images = imgInput ? imgInput.split(',').map(s => s.trim()).filter(Boolean) : ["https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=1200"];
  const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()) : ["Новое"];
  const featuresArr = featuresInput ? featuresInput.split(',').map(f => f.trim()) : [];
  const features = {
    area: featuresArr[0] || 'Не указано',
    rooms: featuresArr[1] || 'Не указано',
    floor: featuresArr[2],
    land: featuresArr[3]
  };

  const newId = Math.max(...[...properties.sale, ...properties.rental].map(p => p.id || 0)) + 1;
  const newProp = {id: newId, ru, kk, price, desc, location, year, features, images, tags, type};

  properties[cat].unshift(newProp);
  localStorage.setItem('properties_' + cat, JSON.stringify(properties[cat]));
  render(cat);
  alert("Объект добавлен!");
  confetti();
  document.querySelector('#addPropTab').querySelectorAll('input, textarea, select').forEach(el => el.value = '');
}

function renderRequests() {
  const list = document.getElementById('requestsList');
  list.innerHTML = requests.sort((a,b) => new Date(b.date) - new Date(a.date)).map((r,i) => `
    <div class="request-card" id="req-${i}">
      <div class="request-header">
        <strong>${r.name} (${r.phone})</strong>
        <span style="font-size:12px;color:#888">${r.date}</span>
      </div>
      <p><strong>Сообщение:</strong> ${r.message}</p>
      ${r.response ? `<p style="background:#e6f7ee;padding:10px;border-radius:8px;margin-top:10px;"><strong>Ответ:</strong> ${r.response}</p>` : ''}
      <div class="request-actions">
        <button class="btn primary small" onclick="openEditRequest(${i})">Редактировать</button>
        <button class="btn success small" onclick="openResponseModal(${i})">Ответить</button>
        <button class="btn danger small" onclick="deleteRequest(${i})">Удалить</button>
      </div>
    </div>
  `).join('');
}

function deleteRequest(index) {
  if (!confirm("Удалить заявку?")) return;
  requests.splice(index, 1);
  localStorage.setItem('requests', JSON.stringify(requests));
  renderRequests();
  alert("Заявка удалена!");
}

function openEditRequest(index) {
  const r = requests[index];
  const modal = document.createElement('div');
  modal.className = 'modal show';
  modal.innerHTML = `
    <div class="modal-content">
      <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
      <h2>Редактировать заявку</h2>
      <div class="form-group">
        <label for="editReqName">Имя</label>
        <input id="editReqName" value="${r.name}">
      </div>
      <div class="form-group">
        <label for="editReqPhone">Телефон</label>
        <input id="editReqPhone" value="${r.phone}">
      </div>
      <div class="form-group">
        <label for="editReqMessage">Сообщение</label>
        <textarea id="editReqMessage" rows="4">${r.message}</textarea>
      </div>
      <button class="btn primary" onclick="saveEditRequest(${index}, this)">Сохранить</button>
    </div>
  `;
  document.body.appendChild(modal);
}

function saveEditRequest(index, btn) {
  const name = document.getElementById('editReqName').value.trim();
  const phone = document.getElementById('editReqPhone').value.trim();
  const message = document.getElementById('editReqMessage').value.trim();
  if (!name || !phone) return alert('Имя и телефон обязательны');
  requests[index] = { ...requests[index], name, phone, message };
  localStorage.setItem('requests', JSON.stringify(requests));
  renderRequests();
  btn.closest('.modal').remove();
  alert("Заявка обновлена!");
  confetti();
}

function openResponseModal(index) {
  const modal = document.createElement('div');
  modal.className = 'modal show';
  modal.innerHTML = `
    <div class="modal-content">
      <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
      <h2>Ответить на заявку</h2>
      <p><strong>Клиент:</strong> ${requests[index].name} (${requests[index].phone})</p>
      <textarea id="responseText" rows="4" placeholder="Ваш ответ..."></textarea>
      <button class="btn primary" onclick="saveResponse(${index}, this)">Отправить</button>
    </div>
  `;
  document.body.appendChild(modal);
}

function saveResponse(index, btn) {
  const response = document.getElementById('responseText').value.trim();
  if (!response) return alert('Напишите ответ');
  requests[index].response = response;
  localStorage.setItem('requests', JSON.stringify(requests));
  renderRequests();
  btn.closest('.modal').remove();
  alert("Ответ сохранен!");
  confetti();
}

function renderEditProps() {
  const list = document.getElementById('editPropsList');
  const allProps = [...properties.sale, ...properties.rental];
  list.innerHTML = allProps.map(p => `
    <div class="edit-card">
      <span>${p.ru} (${p.price.toLocaleString()} ₸)</span>
      <div>
        <button class="btn primary" onclick="openEditProperty(${p.id})">Редактировать</button>
        <button class="btn danger" onclick="deleteProperty(${p.id})">Удалить</button>
      </div>
    </div>
  `).join('');
}

function openEditProperty(id) {
  const prop = [...properties.sale, ...properties.rental].find(p => p.id === id);
  const cat = properties.sale.find(p => p.id === id) ? 'sale' : 'rental';
  const featuresStr = [prop.features.area, prop.features.rooms, prop.features.floor, prop.features.land].filter(Boolean).join(', ');
  document.getElementById('editPropertyForm').innerHTML = `
    <input type="hidden" id="editId" value="${prop.id}">
    <input type="hidden" id="editCat" value="${cat}">
    <div class="form-group">
      <label for="editTitleRu">Название RU</label>
      <input id="editTitleRu" value="${prop.ru}">
    </div>
    <div class="form-group">
      <label for="editTitleKk">Название KK</label>
      <input id="editTitleKk" value="${prop.kk}">
    </div>
    <div class="form-group">
      <label for="editPrice">Цена</label>
      <input id="editPrice" type="number" value="${prop.price}">
    </div>
    <div class="form-group">
      <label for="editDesc">Описание</label>
      <textarea id="editDesc" rows="4">${prop.desc}</textarea>
    </div>
    <div class="form-group">
      <label for="editLocation">Локация</label>
      <input id="editLocation" value="${prop.location}">
    </div>
    <div class="form-group">
      <label for="editYear">Год постройки</label>
      <input id="editYear" type="number" value="${prop.year}">
    </div>
    <div class="form-group">
      <label for="editFeatures">Особенности (площадь, комнаты, этаж/земля через ,)</label>
      <input id="editFeatures" value="${featuresStr}">
    </div>
    <div class="form-group">
      <label for="editImg">Изображения (через ,)</label>
      <input id="editImg" value="${prop.images.join(', ')}">
    </div>
    <div class="form-group">
      <label for="editTags">Теги (через ,)</label>
      <input id="editTags" value="${prop.tags.join(', ')}">
    </div>
    <div class="form-group">
      <label for="editType">Тип</label>
      <select id="editType"><option value="apartment" ${prop.type === 'apartment' ? 'selected' : ''}>Квартира</option><option value="house" ${prop.type === 'house' ? 'selected' : ''}>Дом</option><option value="commercial" ${prop.type === 'commercial' ? 'selected' : ''}>Коммерческая</option></select>
    </div>
    <button class="btn primary" onclick="saveEditProperty()">Сохранить</button>
  `;
  document.getElementById('editPropertyModal').classList.add('show');
}

function saveEditProperty() {
  const id = parseInt(document.getElementById('editId').value);
  const cat = document.getElementById('editCat').value;
  const ru = document.getElementById('editTitleRu').value.trim();
  const kk = document.getElementById('editTitleKk').value.trim();
  const price = parseInt(document.getElementById('editPrice').value);
  const desc = document.getElementById('editDesc').value.trim();
  const location = document.getElementById('editLocation').value.trim();
  const year = parseInt(document.getElementById('editYear').value);
  const featuresInput = document.getElementById('editFeatures').value.trim();
  const imgInput = document.getElementById('editImg').value.trim();
  const tagsInput = document.getElementById('editTags').value.trim();
  const type = document.getElementById('editType').value;

  if (!ru || !kk || !price || !desc || !location) return alert("Заполните обязательные поля!");

  const images = imgInput.split(',').map(s => s.trim()).filter(Boolean);
  const tags = tagsInput.split(',').map(t => t.trim());
  const featuresArr = featuresInput.split(',').map(f => f.trim());
  const features = {
    area: featuresArr[0] || 'Не указано',
    rooms: featuresArr[1] || 'Не указано',
    floor: featuresArr[2],
    land: featuresArr[3]
  };

  const index = properties[cat].findIndex(p => p.id === id);
  if (index !== -1) {
    properties[cat][index] = { ...properties[cat][index], ru, kk, price, desc, location, year, features, images, tags, type };
    localStorage.setItem('properties_' + cat, JSON.stringify(properties[cat]));
    render(cat);
    renderEditProps();
    closeModal('editPropertyModal');
    alert("Объект обновлён!");
    confetti();
  }
}

function deleteProperty(id) {
  if (!confirm("Удалить объект?")) return;
  properties.sale = properties.sale.filter(p => p.id !== id);
  properties.rental = properties.rental.filter(p => p.id !== id);
  localStorage.setItem('properties_sale', JSON.stringify(properties.sale));
  localStorage.setItem('properties_rental', JSON.stringify(properties.rental));
  render('sale');
  render('rental');
  renderEditProps();
  alert("Объект удалён!");
}
  </script>
</body>
</html>
